<% user_message = (message.role == "user") %>

<div class="mb-3 d-flex <%= user_message ? 'justify-content-end' : 'justify-content-start' %>">
  <div class="<%= user_message ? 'bg-primary text-white' : 'bg-light' %> px-3 py-2 rounded-3" style="max-width: 70%;">
    <div class="small mb-1 fw-bold">
      <%= user_message ? "Vous" : "Moody (IA)" %>
    </div>
    <div class="message-content">
      <%= simple_format(message.content) %>



<% if message.url_recommandation.present? %>
  <% video_id = extract_youtube_id(message.url_recommandation) %>
  <% if video_id %>
    <div class="youtube-card mt-2">
      <a href="<%= message.url_recommandation %>" target="_blank" rel="noopener noreferrer" class="text-decoration-none">
        <div class="card border-0 shadow-sm">
          <div class="row g-0">
            <div class="col-md-4">
              <%= image_tag "https://img.youtube.com/vi/#{video_id}/maxresdefault.jpg",
                  alt: "Vidéo YouTube",
                  class: "img-fluid rounded-start",
                  style: "width: 100%; height: 100%; object-fit: cover; min-height: 120px;" %>
            </div>
            <div class="col-md-8">
              <div class="card-body d-flex flex-column justify-content-center">
                <h6 class="card-title mb-2">Vidéo recommandée</h6>
                <p class="card-text text-muted small mb-0">Cliquez pour regarder sur YouTube</p>
                <div class="mt-2">
                  <span class="badge bg-danger">▶ Regarder</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </a>
    </div>
  <% end %>
<% end %>
</div>

 <div class="text-end small text-muted mt-1">
      <%= l(message.created_at, format: :short) rescue message.created_at.to_s %>
    </div>
  </div>
</div>
