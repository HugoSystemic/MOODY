<% user_message = (message.role == "user") %>
<div class="message-bubble <%= user_message ? 'user-message' : 'ai-message' %>">
  <div class="bubble-content">
    <div class="message-header">
      <%= user_message ? "Vous" : "Moody (IA)" %>
    </div>
    <div class="message-content">
      <%= simple_format(message.content) %>

      <% if message.url_recommandation.present? %>
        <% video_id = extract_youtube_id(message.url_recommandation) %>
        <% if video_id %>
          <div class="youtube-card">
            <a href="<%= message.url_recommandation %>" target="_blank" rel="noopener noreferrer">
              <div class="card">
                <div class="row g-0">
                  <div class="col-md-4">
                    <%= image_tag "https://img.youtube.com/vi/#{video_id}/maxresdefault.jpg",
                        alt: "Vidéo YouTube",
                        class: "img-fluid rounded-start" %>
                  </div>
                  <div class="col-md-8">
                    <div class="card-body">
                      <h6 class="card-title">Vidéo recommandée</h6>
                      <p class="card-text small mb-0">Cliquez pour regarder sur YouTube</p>
                      <div class="mt-2">
                        <span class="badge bg-danger">▶ Regarder</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </a>
          </div>
        <% end %>
      <% end %>
    </div>
    <div class="message-timestamp">
      <%= l(message.created_at, format: :short) rescue message.created_at.to_s %>
    </div>
  </div>
</div>
