<%# app/views/musics/index.html.erb %>

<div class="container mt-5">
  <h1 class="mb-4">üéß Mes Musiques</h1>

  <% @musics.each do |music| %>
    <%
      # L'URL de la vid√©o est stock√©e dans la colonne 'video_url' du mod√®le Music
      video_url = music.video_url

      # Utilisation du helper existant pour extraire l'ID n√©cessaire √† l'iframe
      youtube_id = defined?(extract_youtube_id) ? extract_youtube_id(video_url) : nil
    %>

    <div class="card mb-4 p-3 shadow-sm">
      <div class="row">

        <div class="col-md-6">
          <h5 class="card-title text-primary"><%= music.title.presence || "Titre non disponible" %></h5>

          <% if video_url.present? && youtube_id %>
            <div class="embed-responsive embed-responsive-16by9">
              <iframe class="embed-responsive-item"
                      src="https://www.youtube.com/embed/<%= youtube_id %>"
                      allowfullscreen
                      style="width: 100%; height: 315px; border: none;">
              </iframe>
            </div>
            <div class="mt-2 text-center">
              <%= link_to "Voir sur YouTube", video_url, target: "_blank", rel: "noopener noreferrer", class: "btn btn-outline-danger btn-sm" %>
            </div>
          <% else %>
            <div class="alert alert-warning" role="alert">
              Vid√©o non disponible ou lien invalide. (URL: <%= video_url %>)
            </div>
          <% end %>
        </div>

        <div class="col-md-6">
          <h6 class="mt-md-0 mt-3 border-bottom pb-2">Contexte de la session :</h6>
          <ul class="list-unstyled">
            <li><strong>Session associ√©e :</strong>
              <%= link_to music.chat.title, chat_path(music.chat) %>
            </li>
            <li><strong>Mood associ√© :</strong> <span class="badge bg-info"><%= music.chat.mood %></span></li>
            <li><strong>Activit√© :</strong> <%= music.chat.activity %></li>
            <% if music.chat.duration.present? %>
              <li><strong>Dur√©e demand√©e :</strong> <%= music.chat.duration / 60 %> minutes</li>
            <% end %>
            <li>---</li>
            <li><strong>Cat√©gorie (Musique) :</strong> <%= music.category.presence || 'Non sp√©cifi√©e' %></li>
            <li><strong>Dur√©e (Musique) :</strong> <%= music.duration_minutes %> minutes</li>
            <li><strong>Aim√© (Music) :</strong>
              <% if music.liked %>
                <i class="fas fa-heart text-danger"></i> Oui
              <% else %>
                Non
              <% end %>
            </li>
          </ul>
        </div>
      </div>
    </div>
  <% end %>

  <% if @musics.empty? %>
    <div class="alert alert-info">
      Vous n'avez pas encore de musiques enregistr√©es. Commencez une session de chat pour en ajouter !
    </div>
  <% end %>
</div>
